<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N2JZPNV27G"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-N2JZPNV27G');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Travel Quiz</title>
    <style>
        * {
            margin: -2;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(rgb(0 158 255 / 11%) 0%, rgb(0 175 255 / 7%) 100%);
            color: #000000;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Hero Section */
        .hero-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        /* Main Container */
        .main-container, .container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 60px 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 10;
            margin: 0 auto;
        }

        /* Title Section */
        .title-section {
            text-align: center;
            margin-bottom: 50px;
        }

        .main-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #f86d6dc2, #0c5dffbb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 1.2em;
            color: rgba(8, 0, 0, 0.8);
            margin-top: 20px;
            font-family: Georgia, serif;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            gap: 25px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(18, 70, 243, 0.3);
        }

        .feature-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .feature-icon {
            font-size: 1.5em;
        }

        .feature-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #e88896;
        }

        .feature-description {
            line-height: 1.6;
            color: rgba(0, 0, 0, 0.8);
        }

        /* Warning Card */
        .warning-card {
            background: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
            animation: pulse 3s infinite;
        }

        .warning-card .feature-title {
            color: #e74c3c;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        /* CTA Section */
        .cta-section {
            text-align: center;
            margin-top: 40px;
        }

        .cta-question {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: rgba(0, 0, 0, 0.9);
            font-family: Georgia, serif;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        .start-btn, .next-btn {
            background: linear-gradient(45deg, #ffadb9, #2366edbb);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 50px;
            font-size: 1.2em;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgb(84 32 45 / 30%);
            display: block;
            margin: 30px auto 0;
        }

        .start-btn:hover, .next-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px #51488180;
        }

        .next-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Trust Section */
        .trust-section {
            margin-top: 40px;
            text-align: center;
            color: rgba(0, 0, 0, 0.5);
            font-size: 0.9em;
        }

        /* Demographics Section */
        .demographic-section {
            margin-bottom: 25px;
        }

        .demographic-section label {
            display: block;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .demographic-section select {
            width: 100%;
            padding: 15px;
            background: rgb(60 47 47 / 10%);
            border: 2px solid rgb(255 135 135 / 20%);
            border-radius: 12px;
            color: rgb(0, 0, 0);
            font-size: 1em;
        }

        .demographic-section select option {
            background: #1a1a2e;
            color: rgb(10, 0, 0);
        }

        .demographic-section select:focus {
            outline: none;
            border-color: #a88086;
            box-shadow: 0 0 20px rgba(251, 154, 154, 0.3);
        }

        /* Progress Bar */
        .progress-container {
            margin-bottom: 30px;
            text-align: center;
        }

        .progress-counter {
            color: #241a2e;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(45deg, #ffa9cb, #225df37a);
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        /* Question Container */
        .question-container {
            animation: fadeIn 0.5s ease-in;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Scenario Section */
        .scenario {
            background: linear-gradient(180deg, rgb(254 224 224 / 10%) 0%, rgb(249 217 225 / 3%) 100%);
            border: 2px solid #775675;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
            font-size: 1.2em;
            line-height: 1.8;
            color: #030000;
            font-weight: 500;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 20px #655f6e;
        }

        .scenario::before {
            content: "SCENARIO";
            position: absolute;
            top: -12px;
            left: 30px;
            background: #1a1a2e;
            padding: 0 15px;
            color: #e88896;
            font-size: 0.8em;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* Choices Section */
        .choices {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .choice.selected {
            background: rgba(110, 183, 247, 0.11);
            border-color: #6691ff;
        }
        

        .choice {
            background: rgb(87 167 247 / 0%);
            border: 2px solid rgb(76 167 255 / 41%);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .choice:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #6691ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(156, 203, 253, 0.3);
        }

        .element.style {
            text-align: center;
            color: #e88896;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .multi-select-info {
            text-align: center;
            color: rgba(255, 131, 164, 0.53);
            margin-bottom: 20px;
            font-weight: bold;
        }

        /* Results */
        .result-container {
            animation: fadeIn 0.8s ease-in;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .personality-intro {
            background: rgb(205 230 255 / 73%);
            border: 2px solid #8bb0be;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        

        .personality-text {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .warning-text {
            font-size: 1.1em;
            color: #ff2400de;
            font-weight: bold;
            margin-top: 20px;
            animation: pulse 2s infinite;
        }

        /* Cards */
        .cards-container {
            display: flex;
            gap: 30px;
            margin: 40px 0;
            justify-content: center;
            flex-wrap: wrap;
            max-width: 100%;
        }

        .character-card {
            width: 350px;
            height: 500px;
            position: relative;
            perspective: 1000px;
            cursor: pointer;
            animation: slideIn 0.6s ease-out forwards;
            opacity: 0;
            flex-shrink: 0;
        }

        .character-card:nth-child(1) { animation-delay: 0.3s; }
        .character-card:nth-child(2) { animation-delay: 0.6s; }
        .character-card:nth-child(3) { animation-delay: 0.9s; }

        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .character-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card-front {
            background: linear-gradient(358deg, #d1e7fe40 0%, #277dff17 100%);
            border: 2px solid rgba(49, 122, 146, 0.3);
        }

        .card-back {
            background: linear-gradient(135deg, #7b3636 0%, #5a2f2f 100%);
            border: 2px solid #c11818;
            transform: rotateY(180deg);
        }

        .match-percentage {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(226, 10, 10, 0.796);
            color: white;
            padding: 4px 6px;
            border-radius: 70px;
            font-weight: bold;
            font-size: 1em;
        }

        .card-title {
            font-size: 1.5em;
            color: #e97f8f;
            margin-bottom: 20px;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .character-avatars {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .avatar {
            background: rgb(153 176 255 / 30%);
            padding: 9px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            border: 1px solid rgb(80 111 171 / 20%);
        }

        .attraction-text {
            font-style: italic;
            line-height: 1.6;
            opacity: 0.9;
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        .click-to-flip {
            background: rgba(255, 84, 84, 0.2);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9em;
            margin-top: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .red-flags {
            margin: 20px 0;
        }

        .red-flag {
            background: rgba(231, 76, 60, 0.2);
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 10px 10px 0;
            font-size: 0.95em;
        }

        .red-flag strong {
            color: #df0000;
            display: block;
            margin-bottom: 5px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container, .container {
                padding: 40px 25px;
            }

            .main-title {
                font-size: 2em;
            }

            .feature-card {
                padding: 25px;
            }

            .feature-title {
                font-size: 1.1em;
            }

            .start-btn, .next-btn {
                padding: 15px 40px;
                font-size: 1.1em;
            }

            .cards-container {
                flex-direction: column;
                align-items: center;
            }
            
            .character-card {
                width: 100%;
                max-width: 350px;
            }
        }

        /* Hide sections by default */
        .hidden {
            display: none !important;
        }

        /* Status indicator for Google Sheets */
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 1000;
            display: none;
        }

        .status-success {
            background: rgba(46, 204, 113, 0.9);
            color: white;
        }

        .status-error {
            background: rgba(231, 76, 60, 0.9);
            color: white;
        }

        .status-info {
            background: rgba(52, 152, 219, 0.9);
            color: white;
        }

        .archetype-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 25px;
            padding: 20px 0;
        }

        .keyword-tag {
            background: linear-gradient(45deg, #ff8495a8, #ff7388ab);
            border: 1px solid #c2bfff;
            color: #fafafa;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }

        .keyword-tag:nth-child(1) { animation-delay: 0.1s; }
        .keyword-tag:nth-child(2) { animation-delay: 0.2s; }
        .keyword-tag:nth-child(3) { animation-delay: 0.3s; }
        .keyword-tag:nth-child(4) { animation-delay: 0.4s; }
        .keyword-tag:nth-child(5) { animation-delay: 0.5s; }
        .keyword-tag:nth-child(6) { animation-delay: 0.6s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .keyword-tag:hover {
            background: linear-gradient(45deg, rgba(243, 156, 18, 0.3), rgba(231, 76, 60, 0.3));
            border-color: rgba(243, 156, 18, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.2);
            transition: all 0.3s ease;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .archetype-keywords {
                gap: 8px;
                padding: 15px 0;
            }
            
            .keyword-tag {
                padding: 6px 12px;
                font-size: 0.8em;
            }
        }
        .section-header {
            text-align: center;
            margin: 40px auto 30px;
            max-width: 700px;
        }

        .section-title {
            font-size: 2.2em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #ff8d9e, #7276f4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .section-subtitle {
            font-size: 1.2em;
            color: rgba(0, 0, 0, 0.8);
            line-height: 1.6;
            margin: 0;
            font-style: italic;
        }

        /* Toxic section styling */
        .toxic-section-divider {
            margin: 60px 0 40px;
            padding: 40px 0;
            background: rgb(255 24 0 / 5%);
            border-top: 2px solid rgb(0 0 0 / 20%);
            border-bottom: 2px solid rgb(255 24 0 / 20%);
        }

        .toxic-header {
            margin: 0 auto;
        }

        .toxic-title {
            background: linear-gradient(45deg, #f13d3d, #bc2121);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse-warning 2s ease-in-out infinite;
        }

        .toxic-header .section-subtitle {
            color: rgba(15, 14, 14, 0.9);
            font-weight: 600;
        }

        @keyframes pulse-warning {
            0%, 100% { 
                filter: brightness(1);
                transform: scale(1);
            }
            50% { 
                filter: brightness(1.1);
                transform: scale(1.02);
            }
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .section-title {
                font-size: 1.8em;
            }
            
            .section-subtitle {
                font-size: 1.1em;
                padding: 0 15px;
            }
            
            .toxic-section-divider {
                margin: 40px 0 30px;
                padding: 30px 0;
            }
        }

        /* Animation for section reveals */
        .section-header {
            animation: fadeInUp 0.8s ease-out;
        }

        .toxic-section-divider {
            animation: slideInFromBottom 1s ease-out 0.5s both;
        }

        @keyframes slideInFromBottom {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


    </style>
</head>
<body>
    <!-- Status Indicator -->
    <div id="status-indicator" class="status-indicator"></div>

    <!-- Intro Screen -->
    <section class="hero-section" id="intro-screen">
        <div class="main-container">
            <div class="title-section">
                <h1 class="main-title">Find Your Perfect Match Through an Interactive Travel Story</h1>
                <p class="subtitle">"Your travel choices reveal more than you think..."</p>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-header">
                        <span class="feature-icon">üìñ</span>
                        <h3 class="feature-title">Choose Your Own Adventure</h3>
                    </div>
                    <p class="feature-description">
                        Navigate a couple's trip where every choice shapes your story. 
                        Your decisions create different paths and endings.
                    </p>
                </div>

                <div class="feature-card">
                    <div class="feature-header">
                        <span class="feature-icon">üíò</span>
                        <h3 class="feature-title">More Than Just a Quiz</h3>
                    </div>
                    <p class="feature-description">
                        While you're making travel choices, our algorithm is finding your 
                        ideal dating matches. Strange? Maybe. Accurate? Definitely.
                    </p>
                </div>

                <div class="feature-card">
                    <div class="feature-header">
                        <span class="feature-icon">üîÆ</span>
                        <h3 class="feature-title">The Connection</h3>
                    </div>
                    <p class="feature-description">
                        Your travel decisions reveal personality patterns that predict 
                        exactly who you're attracted to. We use this to show you your matches.
                    </p>
                </div>

                <div class="feature-card warning-card">
                    <div class="feature-header">
                        <span class="feature-icon">‚ö†Ô∏è</span>
                        <h3 class="feature-title">Fair Warning</h3>
                    </div>
                    <p class="feature-description">
                        These aren't the dream dates you're expecting. Each match comes 
                        with hidden red flags you probably won't see coming.
                    </p>
                </div>
            </div>

            <div class="cta-section">
                <p class="cta-question">Ready to take a trip and meet your matches?</p>
                <button class="start-btn" onclick="startJourney()">
                    Start Your Journey ‚Üí
                </button>
            </div>

            <div class="trust-section">
                <p>Takes 5 minutes ‚Ä¢ 100% anonymous ‚Ä¢ Surprisingly accurate</p>
            </div>
        </div>
    </section>

    <!-- Demographics Screen -->
    <div id="demographics-screen" class="hidden">
        <div class="container">
            <h2 style="text-align: center; color: #e88896; margin-bottom: 30px;">Tell Us About Yourself</h2>
            <p style="text-align: center; opacity: 0.8; margin-bottom: 40px;">This helps us provide more personalized insights</p>
            
            <div class="demographic-section">
                <label>What is your ethnicity?</label>
                <select id="ethnicity-select">
                    <option value="">Select your ethnicity</option>
                    <option value="asian">Asian</option>
                    <option value="black">Black/African American</option>
                    <option value="hispanic">Hispanic/Latino</option>
                    <option value="white">White/Caucasian</option>
                    <option value="middle-eastern">Middle Eastern</option>
                    <option value="native">Native American</option>
                    <option value="pacific-islander">Pacific Islander</option>
                    <option value="mixed">Mixed/Multiple</option>
                    <option value="other">Other</option>
                    <option value="prefer-not">Prefer not to say</option>
                </select>
            </div>

            <div class="demographic-section">   
                <label>What is your gender identity?</label>
                <select id="gender-select">
                    <option value="">Select your gender identity</option>
                    <option value="man">Man</option>
                    <option value="woman">Woman</option>
                    <option value="non-binary">Non-binary</option>
                    <option value="genderfluid">Genderfluid</option>
                    <option value="transgender-man">Transgender man</option>
                    <option value="transgender-woman">Transgender woman</option>
                    <option value="agender">Agender</option>
                    <option value="two-spirit">Two-Spirit</option>
                    <option value="other">Other</option>
                    <option value="prefer-not">Prefer not to say</option>
                </select>
            </div>
            
            <div class="demographic-section">
                <label>What is your sexual orientation?</label>
                <select id="orientation-select">
                    <option value="">Select your orientation</option>
                    <option value="straight">Straight/Heterosexual</option>
                    <option value="gay">Gay</option>
                    <option value="lesbian">Lesbian</option>
                    <option value="bisexual">Bisexual</option>
                    <option value="pansexual">Pansexual</option>
                    <option value="asexual">Asexual</option>
                    <option value="queer">Queer</option>
                    <option value="questioning">Questioning</option>
                    <option value="other">Other</option>
                    <option value="prefer-not">Prefer not to say</option>
                </select>
            </div>
            
            <button class="next-btn" onclick="startActualQuiz()">Continue to Quiz</button>
        </div>
    </div>
        
    <!-- Quiz Container -->
    <div id="quiz-container" class="hidden">
        <div class="container">
            <div class="progress-container">
                <span class="progress-counter">
                    Question <span id="currentQuestion">1</span> of <span id="totalQuestions">11</span>
                </span>
                <div class="progress-bar-wrapper">
                    <div class="progress-bar-fill" id="progressFill" style="width: 9%;"></div>
                </div>
            </div>
            <div id="question-content"></div>
        </div>
    </div>    

    <!-- Result Container -->
    <div id="result-container" class="hidden">
        <div id="result-content"></div>
    </div>

    <script>
        // Quiz data structure with ALL original questions
        // Weekend City Adventure - Complete question set maintaining all psychological insights
        const questions = {
            "1": {
                scenario: "You're planning a weekend getaway to a city a few hours away. How many days do you want your trip to be?",
                choices: [
                    { text: "Let's pick whatever number of days makes us both feel relaxed and connected.", next: "2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "I'll check our budget and work schedules to choose the most practical trip length.", next: "2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Let's go as long as we can manage‚Äîmore days means more chances for spontaneous adventures.", next: "2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "2": {
                scenario: "Now you need to decide where to stay. You've always wanted to experience the historic downtown area, but your partner thinks the trendy arts district would be more fun.",
                choices: [
                    { text: "If the arts district makes you happier, I'm good with it.", next: "3.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Downtown makes more sense‚Äîeasier parking, better access to major attractions, and more dining options.", next: "3.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "The arts district just feels right to me‚ÄîI love the idea of exploring somewhere more creative and unexpected.", next: "3.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "3.1": {
                scenario: "You guys are heading to the arts district! You're excited. But the night before you leave, your partner tells you work came up and they have to stay behind for another day.",
                choices: [
                    { text: "I'll cancel and reschedule so we arrive together. I don't want to explore a new city alone.", next: "4.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "I'll compare cancellation fees; if it's too expensive, I'll drive up today, check in, and you can join me tomorrow.", next: "4.3", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "This is actually great‚Äîmore time to wander around solo. I'll head up today and explore until you arrive tomorrow.", next: "4.3", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "3.2": {
                scenario: "You guys are staying downtown! You're excited. But the night before you leave, your partner tells you work came up and they have to stay behind for another day.",
                choices: [
                    { text: "I don't want to experience a new city without you. Let me reschedule so we can go together.", next: "4.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Let me check the rescheduling costs first. If they're reasonable, I'll wait. If not, I'll go ahead and you can join tomorrow.", next: "4.4", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Actually, this could be fun! I'll go explore downtown on my own and have stories to share when you arrive.", next: "4.4", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "4.1": {
                scenario: "You canceled your trip and are staying home tonight. It's late evening and your partner still hasn't replied to any texts all day.",
                choices: [
                    { text: "You pick up your phone again and text: 'Please let me know you're okay‚ÄîI'm really worried.'", next: "5.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "You decide to leave the house for a bit‚Äîgrab coffee at a nearby caf√© and take a walk until they respond.", next: "5.1", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "They're probably still tied up with work. I'll confirm that our rescheduled plans are all set and avoid reaching out until necessary.", next: "5.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "4.2": {
                scenario: "You canceled your trip and are staying home tonight. It's late evening and your partner still hasn't replied to any texts all day.",
                choices: [
                    { text: "You pick up your phone again and text: 'Please let me know you're okay‚ÄîI'm really worried.'", next: "5.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "They're probably swamped with work. I'll get some fresh air and grab coffee until they respond.", next: "5.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Work emergencies happen. I'll double-check our new hotel booking and wait for them to reach out.", next: "5.2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "4.3": {
                scenario: "You arrive in the arts district alone because your partner's trip was pushed to tomorrow. Your hotel room is ready; it's 2 PM and you have the whole afternoon free.",
                choices: [
                    { text: "I'll go to that cute gallery caf√© we both wanted to visit‚Äîand send them a photo so they feel part of it.", next: "5.3", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Let's stick to the plan and take that self-guided art walk since I'm already here‚Äîno need to reinvent the day.", next: "5.3", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "I'll just wander around and see what catches my eye in this neighborhood.", next: "5.3", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "4.4": {
                scenario: "You arrive downtown alone because your partner's trip was pushed to tomorrow. Your hotel room is ready; it's 2 PM and you have the whole afternoon free.",
                choices: [
                    { text: "I'll go to that historic caf√© we both wanted to visit‚Äîand send them photos so they feel part of it.", next: "5.4", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Let's stick to the plan and take that walking tour since I'm already here‚Äîno need to change everything.", next: "5.4", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "I'll just wander around and see what catches my eye in these historic streets.", next: "5.4", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "5.1": {
                scenario: "Later, your partner arrives at your place. 'Work has been crazy and I'm sorry for not replying to your texts all day,' they say.",
                choices: [
                    { text: "I was so worried! I felt completely ignored and it really hurt my feelings. I need you to understand how that made me feel.", next: "6.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "I understand work gets hectic. Just send a quick 'busy today' text next time so I know what's happening.", next: "6.1", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "No worries! I ended up discovering some cool local places on my own. Actually worked out pretty well - want to hear about it?", next: "6.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "5.2": {
                scenario: "Later, your partner arrives at your place. 'Work has been crazy and I'm sorry for not replying to your texts all day,' they say.",
                choices: [
                    { text: "I was so worried! I felt completely ignored and it really hurt my feelings. I need you to understand how that made me feel.", next: "6.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "I understand work gets hectic. Just send a quick 'busy today' text next time so I know what's happening.", next: "6.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "No worries! I ended up discovering some cool local places on my own. Actually worked out pretty well - want to hear about it?", next: "6.2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "5.3": {
                scenario: "You're walking through the arts district when you see a street artist creating an incredible mural‚Äîbut your phone battery is at 5%.",
                choices: [
                    { text: "This is too amazing not to capture‚ÄîI'll risk my phone dying for this moment.", next: "6.3", scores: { emotional: 0, logical: 0, exploratory: 2 } },
                    { text: "I'll snap one quick photo, then save the rest of my battery.", next: "6.3", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "I'll just enjoy this without my phone‚Äîsome moments are better experienced than photographed.", next: "6.3", scores: { emotional: 2, logical: 0, exploratory: 0 } }
                ]
            },
            "5.4": {
                scenario: "You're strolling through downtown when you hear a street musician playing something so moving you stop in your tracks‚Äîbut your phone battery is at 5%.",
                choices: [
                    { text: "This is too amazing not to capture‚ÄîI'll risk my phone dying for this moment.", next: "6.4", scores: { emotional: 0, logical: 1, exploratory: 1 } },
                    { text: "I'll snap one quick photo, then save the rest of my battery.", next: "6.4", scores: { emotional: 1, logical: 1, exploratory: 0 } },
                    { text: "I'll just enjoy this without my phone‚Äîsome moments are better experienced than photographed.", next: "6.4", scores: { emotional: 1, logical: 0, exploratory: 1 } }
                ]
            },
            "6.1": {
                scenario: "The next day, you and your partner drive up to the city and check into your hotel. Now you have a few hours before dinner. Pick exactly two of these to begin your city adventure:",
                multiSelect: 2,
                choices: [
                    { text: "City Hall & Historic District - Visit the iconic buildings and learn about the city's history", next: "7.1", scores: { emotional: 0, logical: 1, exploratory: 0 } },
                    { text: "Scenic Overlook - Share a romantic moment looking out over the whole city", next: "7.2", scores: { emotional: 1, logical: 0, exploratory: 0 } },
                    { text: "Hidden Speakeasy - Discover a secret local bar tucked away from the tourist crowds", next: "7.3", scores: { emotional: 0, logical: 0, exploratory: 1 } }
                ]
            },
            "6.2": {
                scenario: "The next day, you and your partner drive up to the city and check into your hotel. Now you have a few hours before dinner. Pick exactly two of these to begin your city adventure:",
                multiSelect: 2,
                choices: [
                    { text: "Art Museum - Explore the city's famous collection and cultural exhibits", next: "7.4", scores: { emotional: 0, logical: 1, exploratory: 0 } },
                    { text: "Rooftop Garden - Share a romantic view from the city's most beautiful elevated spot", next: "7.5", scores: { emotional: 1, logical: 0, exploratory: 0 } },
                    { text: "Local Market - Hunt down the authentic food market that locals rave about", next: "7.6", scores: { emotional: 0, logical: 0, exploratory: 1 } }
                ]
            },
            "6.3": {
                scenario: "The next day, your partner arrives and you both check into your hotel. With a few hours to kill before dinner, you decide to explore. Pick exactly two activities to start your adventure:",
                multiSelect: 2,
                choices: [
                    { text: "City Hall & Historic District - Visit the iconic buildings and learn about the city's history", next: "7.1", scores: { emotional: 0, logical: 1, exploratory: 0 } },
                    { text: "Scenic Overlook - Share a romantic moment looking out over the whole city", next: "7.2", scores: { emotional: 1, logical: 0, exploratory: 0 } },
                    { text: "Hidden Speakeasy - Discover a secret local bar tucked away from the tourist crowds", next: "7.3", scores: { emotional: 0, logical: 0, exploratory: 1 } }
                ]
            },
            "6.4": {
                scenario: "The next day, your partner arrives and you both check into your hotel. With a few hours to kill before dinner, you decide to explore. Pick exactly two activities to start your adventure:",
                multiSelect: 2,
                choices: [
                    { text: "Art Museum - Explore the city's famous collection and cultural exhibits", next: "7.4", scores: { emotional: 0, logical: 1, exploratory: 0 } },
                    { text: "Rooftop Garden - Share a romantic view from the city's most beautiful elevated spot", next: "7.5", scores: { emotional: 1, logical: 0, exploratory: 0 } },
                    { text: "Local Market - Hunt down the authentic food market that locals rave about", next: "7.6", scores: { emotional: 0, logical: 0, exploratory: 1 } }
                ]
            },
            "7.1": {
                scenario: "As you approach the historic district, your partner suddenly feels overwhelmed by the crowd of tourists. They tug your arm and say, 'Can we leave? I can't focus like this.'",
                choices: [
                    { text: "I'd step aside with them and focus on how they're feeling before anything else.", next: "9.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Sure, but let me grab one quick photo since we made it this far.", next: "9.1", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "I'd point toward that quiet side street and say, 'Let's try exploring over there instead.'", next: "9.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "7.2": {
                scenario: "You're at the scenic overlook just as the sun creates perfect golden hour lighting over the city. Your partner's phone buzzes: it's a friend with last-minute tickets to a rooftop concert starting now.",
                choices: [
                    { text: "I've been looking forward to this view‚Äîlet's stay here. We can't leave now; I want us to share this moment.", next: "9.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "We came here for the view and have 20 minutes of good light left. Let's finish this, then maybe catch the concert after.", next: "9.1", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Rooftop concert? Way more exciting than another viewpoint! Let's go see what happens!", next: "9.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "7.3": {
                scenario: "After finding the hidden speakeasy, the bartender invites you both to join their trivia night that's starting with a small group of regulars.",
                choices: [
                    { text: "Oh my god, that sounds fun! Are you up for it? Let's do it!", next: "9.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Hmm, let me just watch for a sec to see what we're getting into first.", next: "9.1", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Sure, why not? Let's see what happens!", next: "9.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "7.4": {
                scenario: "You're at the art museum with only two hours before it closes. There are so many exhibits to see, but you can't possibly visit everything. How do you decide what to prioritize?",
                choices: [
                    { text: "I really want to see the contemporary wing‚Äîthat's been on my list forever!", next: "9.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Let's pick the top 3 must-see exhibits and focus on those so we don't waste time wandering.", next: "9.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Let's just wander and see what draws us in‚Äîwe might discover something amazing.", next: "9.2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "7.5": {
                scenario: "Your partner wants to write your initials somewhere at the rooftop garden as a memory of your trip. You're not sure how you feel about it.",
                choices: [
                    { text: "It might be a bit cheesy, but it's meaningful to them‚Äîso I'd go for it.", next: "9.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "I'd prefer taking a great selfie‚Äîsomething we'll actually keep and look at later.", next: "9.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Let's write them but somewhere more hidden and unexpected‚Äîfeels more fun and personal.", next: "9.2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "7.6": {
                scenario: "You arrive at the local market filled with amazing food vendors and unique crafts‚Äîyou're overwhelmed by all the choices.",
                choices: [
                    { text: "I'll let my partner pick what looks good to them.", next: "9.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "Check reviews online‚Äîlet's see what other people say are the must-try spots here.", next: "9.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Ask that vendor for their recommendation‚Äîwhen in doubt, trust the locals.", next: "9.2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "9.1": {
                scenario: "It's 7 PM and you're both starving. You find a cozy bistro that looks perfect‚Äîthere's a 45-minute wait for a table. Your partner suggests finding somewhere else nearby.",
                choices: [
                    { text: "But this place looks so perfect and romantic! Can't we just wait? I really had my heart set on this.", next: "10.1", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "45 minutes is too long when we're this hungry. Let's find somewhere nearby - we'll enjoy our food more if we eat sooner.", next: "10.1", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Let's walk around and see what we discover! Maybe we'll find some hidden gem or food truck we never would have tried.", next: "10.1", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "9.2": {
                scenario: "It's 7 PM and you're both starving. You find a cozy bistro that looks perfect‚Äîthere's a 45-minute wait for a table. Your partner suggests finding somewhere else nearby.",
                choices: [
                    { text: "But this place looks so perfect and romantic! Can't we just wait? I really had my heart set on this.", next: "10.2", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "45 minutes is too long when we're this hungry. Let's find somewhere nearby - we'll enjoy our food more if we eat sooner.", next: "10.2", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Let's walk around and see what we discover! Maybe we'll find some hidden gem or food truck we never would have tried.", next: "10.2", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "10.1": {
                scenario: "It's nearly 10 PM and you're both getting tired after your big city day. You could head back to your hotel, but there's a late-night jazz club with live music starting in 15 minutes, or a 24-hour diner that locals say has the best breakfast in the city.",
                choices: [
                    { text: "Live jazz sounds so romantic! Even though we're tired, imagine how perfect it would be to end our day with music and atmosphere!", next: "end", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "We've had a full day and need rest for tomorrow's exploring. Let's head back to the hotel and get proper sleep.", next: "end", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "Local diner at 10 PM? That's where we'll find the real city experience! Who knows what characters we'll meet there.", next: "end", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            },
            "10.2": {
                scenario: "After dinner, you walk past a vintage movie theater showing a classic film that starts in 10 minutes, while across the street there's a retro arcade that looks surprisingly fun and busy.",
                choices: [
                    { text: "Ooh, a classic film sounds so romantic! We could share popcorn in the dark theater - that feels perfect after dinner together.", next: "end", scores: { emotional: 2, logical: 0, exploratory: 0 } },
                    { text: "The movie starts in 10 minutes, so we'd have to rush and might miss the beginning. The arcade has no time pressure - better choice.", next: "end", scores: { emotional: 0, logical: 2, exploratory: 0 } },
                    { text: "A retro arcade? When's the last time we played old-school games? Let's see what weird vintage stuff they have in there!", next: "end", scores: { emotional: 0, logical: 0, exploratory: 2 } }
                ]
            }
        };
        // Archetype definitions
        const archetypes = [
            { name: "Intellectual", logical: 9, emotional: 2, exploratory: 6 },
            { name: "Achiever", logical: 8, emotional: 4, exploratory: 5 },
            { name: "Leader", logical: 7, emotional: 5, exploratory: 6 },
            { name: "Explorer", logical: 3, emotional: 5, exploratory: 10 },
            { name: "Rebel", logical: 4, emotional: 6, exploratory: 9 },
            { name: "Peacemaker", logical: 5, emotional: 7, exploratory: 3 },
            { name: "Dreamer", logical: 2, emotional: 9, exploratory: 8 },
            { name: "Caregiver", logical: 3, emotional: 10, exploratory: 2 }
        ];


                // Character sets organized by gender preference and orientation
        const characterSets = {
            // For straight males (attracted to women)
            "male_straight": {
                "WALKING_TED_TALK": [, "Lisa Simpson", "Paris Geller"],
                "RULEBOOK_ROMANTIC": ["Dolores Umbridge", "Miranda Priestly", "Mother Gothel", "Emily Gilmore", "Nurse Ratched"],
                "POWERHOUSE_PARTNER": ["Miranda Priestly", "Queen of Hearts", "Maleficent", "Cersei Lannister", "Annalise Keating"],
                "ICEBERG": ["Elsa", "Black Widow", "Wednesday Addams", "Rey"],
                "THE_PUPPET_MASTER": ["Jennifer (Jennifer's Body)", "Mystique", "Siren","Catwoman", "Katherine Pierce"],
                "CASTLE_BUILDER": ["Ursula", "Mother Gothel", "Ariel", "Carrie Bradshaw", "Charlotte York"],
                "TRAGIC_HERO": ["Bella Swan", "Hannah Baker", "Jinx", "Marianne", "Ophelia"],
                "THE_ADDICT": ['Jinx', 'Bellatrix Lestrange',"Harley Quinn"]
            },
            
            // For straight females (attracted to men)
            "female_straight": {
                "WALKING_TED_TALK": ["Tony Stark", "Sherlock Holmes", "Light Yagami", "Dr. House", "Spencer Reid"],
                "RULEBOOK_ROMANTIC": ["Captain Holt", "Coach Carter", "Captain Levi", "Jordan Peterson", "Gordon Ramsay"],
                "POWERHOUSE_PARTNER": ["Gustavo Fring", "Logan Roy", "Tywin Lannister", "Harvey Specter", "Frank Underwood"],
                "THE_PUPPET_MASTER": ["Damon Salvatore", "Chuck Bass", "James Bond", "Loki", "Klaus Mikaelson"],
                "ICEBERG": ["Mr. Darcy", "Don Draper", "Batman", "Gojo Satoru", "Edward Cullen"],
                "CASTLE_BUILDER": ["Ted Mosby", "Nate", "Christian", "Noah (Notebook)", "Jack (Titanic)"],
                "TRAGIC_HERO": ["BoJack Horseman", "Peeta Mellark", "Severus Snape", "Kylo Ren", "Edward Cullen"],
                "THE_ADDICT": ['Joker', 'Jack Sparrow', 'Deadpool','The Mad Hatter']
            },
            
            // For gay males (attracted to men)
            "male_gay": {
                "WALKING_TED_TALK": ["Tony Stark", "Sherlock Holmes", "Spencer Reid", "Dr. House", "Hannibal Lecter"],
                "RULEBOOK_ROMANTIC": ["Captain Holt", "Captain America", "Soldier 76", "Coach Carter", "Gordon Ramsay"],
                "POWERHOUSE_PARTNER": ["Gustavo Fring", "Logan Roy", "Harvey Specter", "Tywin Lannister", "Frank Underwood"],
                "THE_PUPPET_MASTER": ["Damon Salvatore", "Chuck Bass", "James Bond", "Loki", "Klaus Mikaelson"],
                "ICEBERG": ["Batman", "Mr. Darcy", "Don Draper", "Gojo Satoru", "Kylo Ren"],
                "CASTLE_BUILDER": ["Ted Mosby", "Noah (Notebook)", "Prince Eric", "Flynn Rider", "Kristoff"],
                "TRAGIC_HERO": ["BoJack Horseman", "Kylo Ren", "Severus Snape", "Peeta Mellark", "Bucky Barnes"],
                "THE_ADDICT": ['Joker', 'Jack Sparrow', 'Deadpool','The Mad Hatter']
            },
            
            // For lesbians (attracted to women)
            "female_lesbian": {
                "WALKING_TED_TALK": ["Hermione Granger", "Belle", "Lisa Simpson", "Amy Santiago", "Paris Geller"],
                "RULEBOOK_ROMANTIC": ["Miranda Priestly", "Captain Janeway", "Dolores Umbridge", "Mother Gothel", "Emily Gilmore"],
                "POWERHOUSE_PARTNER": ["Claire Underwood", "Miranda Priestly", "Maleficent", "Cersei Lannister", "Shiv Roy"],
                "THE_PUPPET_MASTER": ["Jennifer (Jennifer's Body)", "Mystique", "Siren","Catwoman", "Katherine Pierce"],
                "ICEBERG": ["Elsa", "Black Widow", "Katniss Everdeen", "Rey", "Arya Stark"],
                "CASTLE_BUILDER": ["Anna", "Aurora", "Ariel", "Carrie Bradshaw", "Emma Bovary"],
                "TRAGIC_HERO": ["Bella Swan", "Rue Bennett", "Hannah Baker", "Marianne", "Ophelia"],
                "THE_ADDICT": ['Jinx', 'Bellatrix Lestrange',"Harley Quinn"]
            },
            
            // For bisexual users (mix of both)
            "bisexual": {
                "WALKING_TED_TALK": ["Hermione Granger", "Tony Stark", "Belle", "Sherlock Holmes", "Lisa Simpson"],
                "RULEBOOK_ROMANTIC": ["Miranda Priestly", "Captain Holt", "Dolores Umbridge", "Coach Carter", "Captain Janeway"],
                "POWERHOUSE_PARTNER": ["Claire Underwood", "Gustavo Fring", "Miranda Priestly", "Logan Roy", "Maleficent"],
                "THE_PUPPET_MASTER": ["Catwoman", "Damon Salvatore", "Mystique", "Siren", "Klaus Mikaelson", "Loki"],
                "ICEBERG": ["Elsa", "Batman", "Black Widow", "Mr. Darcy", "Katniss Everdeen"],
                "CASTLE_BUILDER": ["Anna", "Ted Mosby", "Aurora", "Noah (Notebook)", "Ariel"],
                "TRAGIC_HERO": ["Bella Swan", "BoJack Horseman", "Rue Bennett", "Kylo Ren", "Hannah Baker"],
                "THE_ADDICT": ['Jinx', 'Bellatrix Lestrange',"Harley Quinn","Joker",'Jack Sparrow']
            },
            
            // Default fallback (mixed characters)
            "default": {
                "WALKING_TED_TALK": ["Hermione Granger", "Tony Stark", "Belle", "Sherlock Holmes", "Lisa Simpson"],
                "RULEBOOK_ROMANTIC": ["Miranda Priestly", "Captain Holt", "Dolores Umbridge", "Coach Carter", "Captain Janeway"],
                "POWERHOUSE_PARTNER": ["Claire Underwood", "Gustavo Fring", "Miranda Priestly", "Logan Roy", "Maleficent"],
                "THE_PUPPET_MASTER": ["Catwoman", "Damon Salvatore", "Mystique", "Siren", "Klaus Mikaelson", "Loki"],
                "ICEBERG": ["Elsa", "Batman", "Black Widow", "Mr. Darcy", "Katniss Everdeen"],
                "CASTLE_BUILDER": ["Anna", "Ted Mosby", "Aurora", "Noah (Notebook)", "Ariel"],
                "TRAGIC_HERO": ["Bella Swan", "BoJack Horseman", "Rue Bennett", "Kylo Ren", "Hannah Baker"],
                "THE_ADDICT": ['Jinx', 'Bellatrix Lestrange',"Harley Quinn",'Joker','Jack Sparrow']
            }
        };

        // Function to determine character set based on demographics
        function getCharacterSet(gender, orientation) {
            console.log(`Getting character set for: ${gender}, ${orientation}`);
            
            // Handle different orientation inputs
            const normalizedOrientation = orientation.toLowerCase();
            
            // Create demographic key
            let demographicKey;
            
            if (gender === 'man' && (normalizedOrientation === 'straight' || normalizedOrientation === 'heterosexual')) {
                demographicKey = 'male_straight';
            } else if (gender === 'woman' && (normalizedOrientation === 'straight' || normalizedOrientation === 'heterosexual')) {
                demographicKey = 'female_straight';
            } else if (gender === 'man' && normalizedOrientation === 'gay') {
                demographicKey = 'male_gay';
            } else if (gender === 'woman' && (normalizedOrientation === 'lesbian' || normalizedOrientation === 'gay')) {
                demographicKey = 'female_lesbian';
            } else if (normalizedOrientation === 'bisexual' || normalizedOrientation === 'pansexual') {
                demographicKey = 'bisexual';
            } else {
                demographicKey = 'default';
            }
            
            console.log(`Using demographic key: ${demographicKey}`);
            return characterSets[demographicKey] || characterSets.default;
        }

        // Updated vulnerability mappings function
        function getPersonalizedVulnerabilities(archetypeName, gender, orientation) {
            const characterSet = getCharacterSet(gender, orientation);
            console.log('Character set:', characterSet);
            
            // Map archetype names to character set keys
            const archetypeToKey = {
                "Achiever": ["WALKING_TED_TALK", "POWERHOUSE_PARTNER"],
                "Intellectual": ["WALKING_TED_TALK", "RULEBOOK_ROMANTIC"],
                "Leader": ["POWERHOUSE_PARTNER", "THE_PUPPET_MASTER"],
                "Explorer": ["THE_PUPPET_MASTER", "ICEBERG"],
                "Rebel": ["WALKING_TED_TALK", "THE_PUPPET_MASTER","THE_ADDICT"],
                "Peacemaker": ["THE_PUPPET_MASTER", "POWERHOUSE_PARTNER", "CASTLE_BUILDER"],
                "Dreamer": ["CASTLE_BUILDER", "THE_PUPPET_MASTER", "POWERHOUSE_PARTNER"],
                "Caregiver": ["TRAGIC_HERO", "CASTLE_BUILDER"]
            };
            
            const vulnerabilityKeys = archetypeToKey[archetypeName] || ["WALKING_TED_TALK", "THE_PUPPET_MASTER"];
            
            // Build personalized vulnerabilities
            const personalizedVulnerabilities = [];
            
            vulnerabilityKeys.forEach(key => {
                const characters = characterSet[key] || characterSet.default[key];
                
                // Get the vulnerability template based on key
                const template = getVulnerabilityTemplate(key);
                
                personalizedVulnerabilities.push({
                    title: template.title,
                    characters: characters,
                    why: template.why,
                    plotTwist: template.plotTwist,
                    blindSpot: template.blindSpot
                });
            });
            
            return personalizedVulnerabilities;
        }

        // Vulnerability templates
        function getVulnerabilityTemplate(key) {
            const templates = {
                "WALKING_TED_TALK": {
                    title: "THE WALKING TED TALK",
                    why: "You love brilliance. You're drawn to people who seem like they have all the answers.",
                    plotTwist: "They're not sharing wisdom. They're building a fanbase with you as audience #1.",
                    blindSpot: "You confuse charisma with character. Intelligence ‚â† emotional safety."
                },
                "RULEBOOK_ROMANTIC": {
                    title: "THE RULEBOOK ROMANTIC",
                    why: "You love structure. Rules make you feel safe. And when they say 'discipline is love'‚Äîyou believe it.",
                    plotTwist: "It's not structure. It's control dressed up in duty.",
                    blindSpot: "You mistake rigidity for reliability. But love shouldn't feel like a training camp."
                },
                "POWERHOUSE_PARTNER": {
                    title: "THE POWERHOUSE PARTNER",
                    why: "You like confidence, control, and people who take charge. You think they're strong enough to protect you‚Äîand maybe fix you too.",
                    plotTwist: "They're not protecting you. They're managing you.",
                    blindSpot: "You confuse intensity for safety. But control isn't care."
                },
                "THE_PUPPET_MASTER": {
                    title: "THE DANGEROUS CHARMER",
                    why: "They're smooth, magnetic, and just the right amount of broken. You love the rush.",
                    plotTwist: "They don't want connection. They want conquest.",
                    blindSpot: "You think you're the exception. You're actually chapter 12."
                },
                "ICEBERG": {
                    title: "THE ICEBERG",
                    why: "You love mystery. You want someone who's deep, calm, and hard to reach.",
                    plotTwist: "They're not deep. They're just not showing up.",
                    blindSpot: "You think still waters run deep. But these waters never text back."
                },
                "CASTLE_BUILDER": {
                    title: "THE CASTLE BUILDER",
                    why: "They say all the right things. Future vacations, babies, matching tattoos‚Äîyou melt.",
                    plotTwist: "They dream big, but disappear when it's time to act.",
                    blindSpot: "You confuse words with plans. Dreams with dates."
                },
                "TRAGIC_HERO": {
                    title: "THE PERPEPTUAL VICTIM",
                    why: "They need you. Their pain is so raw, so real‚Äîyou're convinced your love is the missing piece that will finally fix them.",
                    plotTwist: "They don't want change. They want sympathy on tap.",
                    blindSpot: "You think you're their lifeline. They don't want healing‚Äîthey want a witness to their suffering."
                }
            };
            
            return templates[key] || templates["WALKING_TED_TALK"];
        }

        // Archetype trait descriptions
        const archetypeTraits = {
            "Intellectual": {
                keywords: ["Analytical", "Curious", "Logical", "Rational", "Detail-oriented", "Knowledge-seeking"],
                description: "You possess a highly analytical approach to life, keenly examining and dissecting information to understand things thoroughly. You have an insatiable curiosity and a deep thirst for knowledge that drives you to continuously learn and expand your understanding. You rely heavily on logic and rationality, preferring to make decisions based on facts and reasoned arguments rather than emotions. You're introspective and detail-oriented, often spending significant time in self-reflection and striving for accuracy in your endeavors."
            },
            "Achiever": {
                keywords: ["Driven", "Goal-oriented", "Competitive", "Organized", "Efficient", "Resilient"],
                description: "You are highly driven to succeed and set lofty goals that you're determined to achieve. You have a strong desire to outperform others and seek recognition through your accomplishments. You're well-organized, meticulous in planning, and value efficiency. Your identity is closely tied to your professional achievements, and you possess an exceptional ability to concentrate on your goals. You're willing to take calculated risks and show strong resilience in recovering from setbacks."
            },
            "Leader": {
                keywords: ["Confident", "Decisive", "Charismatic", "Strategic", "Influential", "Ethical"],
                description: "You have a strong sense of self-assurance and believe in your abilities to make decisions and lead others. You're known for making decisions efficiently under pressure and expressing your views assertively. You possess natural charisma that attracts and motivates others, combined with high emotional intelligence. You're a strategic thinker who can plan for the long-term, and you exhibit a strong sense of ethics and integrity that sets a moral example for others."
            },
            "Explorer": {
                keywords: ["Adventurous", "Spontaneous", "Energetic", "Fearless", "Adaptable", "Thrill-seeking"],
                description: "You are driven by a desire to explore and engage with new and diverse experiences. You're often seen as a thrill-seeker who relishes novel situations. You possess high levels of energy and enthusiasm, especially when pursuing activities that excite you. Your spontaneous nature means you often act on impulse, and you exhibit a fearless attitude, willing to take risks others might avoid. You're typically very adaptable, able to adjust to new environments with ease."
            },
            "Rebel": {
                keywords: ["Independent", "Non-conformist", "Justice-oriented", "Skeptical", "Idealistic", "Unconventional"],
                description: "You value your independence highly and seek autonomy in your actions and decisions. You resist conforming to societal norms and often question traditional ways of doing things. You're naturally skeptical of authority and have a well-developed sense of justice, willing to fight for causes you believe in. You think outside the box and bring unconventional ideas to the table. Your non-conformist nature makes you seem unpredictable at times, but you're driven by idealism and principle."
            },
            "Peacemaker": {
                keywords: ["Harmonious", "Empathetic", "Diplomatic", "Patient", "Nurturing", "Supportive"],
                description: "You are naturally inclined towards maintaining harmony and balance in your environment. You prioritize peace over conflict and often go to great lengths to avoid upsetting situations. You're highly empathetic and capable of understanding others' feelings deeply. You possess a natural talent for diplomacy, often mediating disputes and helping resolve conflicts. You're patient, supportive, and nurturing, providing a calming presence to those around you."
            },
            "Dreamer": {
                keywords: ["Visionary", "Creative", "Idealistic", "Imaginative", "Sensitive", "Possibility-focused"],
                description: "You are driven by a strong sense of vision and ideals, with lofty goals to make a significant impact. Your outlook on life is generally positive, seeing the best in people and focusing on possibilities. You possess a creative and imaginative mind, thinking outside the box and coming up with innovative ideas. You're introspective and emotionally sensitive, feeling emotions deeply and connecting with people on a profound level. Your actions are guided by ideals rather than practical considerations."
            },
            "Caregiver": {
                keywords: ["Nurturing", "Empathetic", "Compassionate", "Reliable", "Self-sacrificing", "Supportive"],
                description: "You have an inherent desire to care for and nurture others, often putting their needs before your own. You're deeply empathetic and attuned to others' emotions and needs. You exhibit genuine concern for others' welfare and are often involved in helping activities. You show deep compassion and understanding, especially towards those in need. Others see you as reliable and dependable, often turning to you for emotional and practical support."
            }
};

        // Google Sheets Configuration
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbzxhjLs4pcUVewAJCaRjK8aO4ukhP7MjoVmtpDCF7Htx_AwvZNsr3wuYh3fbhjj_wKq/exec';

        // Quiz state variables
        let demographics = { ethnicity: '', gender: '', orientation: '' };
        let currentQuestion = "1";
        let scores = { emotional: 0, logical: 0, exploratory: 0 };
        let selectedChoices = new Set();
        let multiSelectNexts = [];
        let pendingQuestions = [];
        let isInMultiSelectSequence = false;
        let multiSelectProgress = 0;
        let questionCount = 0;
        const totalEstimatedQuestions = 11;

        // Google Sheets Integration Functions
        async function saveDemographicsToSheets(demographicsData, quizResults = null) {
            const payload = {
                timestamp: new Date().toISOString(),
                sessionId: generateSessionId(),
                ethnicity: demographicsData.ethnicity,
                gender: demographicsData.gender,
                orientation: demographicsData.orientation,
                archetype: quizResults?.archetype || '',
                emotionalScore: quizResults?.emotional || 0,
                logicalScore: quizResults?.logical || 0,
                exploratoryScore: quizResults?.exploratory || 0,
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                domain: window.location.hostname
            };

            console.log('üöÄ Attempting to save data:', payload);

            // Method 1: Direct POST with CORS
            try {
                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Data saved successfully:', result);
                    showStatus('Data saved!', 'success');
                    return { status: 'success' };
                }
            } catch (error) {
                console.log('‚ö†Ô∏è CORS method failed, trying no-cors:', error.message);
            }

            // Method 2: No-CORS fallback (fire and forget)
            try {
                await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('‚úÖ Data sent via no-cors mode (response unreadable but likely successful)');
                showStatus('Data sent!', 'success');
                return { status: 'sent' };
                
            } catch (error) {
                console.error('‚ùå All methods failed:', error);
                showStatus('Save failed, continuing...', 'error');
                
                // Save locally as backup
                saveToLocalBackup(demographicsData, quizResults);
                return { status: 'failed' };
            }
        }

// Hidden form submission method (bypasses CORS)
        async function submitViaForm(data) {
            return new Promise((resolve, reject) => {
                try {
                    // Create a hidden form
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = GOOGLE_SHEETS_URL;
                    form.style.display = 'none';
                    
                    // Add all data as hidden form fields
                    Object.keys(data).forEach(key => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = data[key];
                        form.appendChild(input);
                    });
                    
                    // Create hidden iframe to submit the form (prevents page navigation)
                    const iframe = document.createElement('iframe');
                    iframe.name = 'hidden_iframe';
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);
                    
                    form.target = 'hidden_iframe';
                    document.body.appendChild(form);
                    
                    // Handle iframe load (indicates form submission completed)
                    iframe.onload = function() {
                        console.log('‚úÖ Form submitted successfully');
                        showStatus('Data saved successfully!', 'success');
                        
                        // Clean up
                        document.body.removeChild(form);
                        document.body.removeChild(iframe);
                        
                        resolve({ status: 'success', message: 'Data saved via form submission' });
                    };
                    
                    // Submit the form
                    form.submit();
                    
                    // Timeout after 10 seconds
                    setTimeout(() => {
                        if (document.body.contains(form)) {
                            document.body.removeChild(form);
                            document.body.removeChild(iframe);
                            resolve({ status: 'timeout', message: 'Form submission timed out but likely succeeded' });
                        }
                    }, 10000);
                    
                } catch (error) {
                    console.error('Form submission error:', error);
                    reject(error);
                }
            });
        }

        // Helper functions
        function generateSessionId() {
            return 'quiz_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        function saveToLocalBackup(demographicsData, quizResults) {
            try {
                let backupData = JSON.parse(localStorage.getItem('quiz_backup') || '[]');
                backupData.push({
                    timestamp: new Date().toISOString(),
                    ethnicity: demographicsData.ethnicity,
                    gender: demographicsData.gender,
                    orientation: demographicsData.orientation,
                    archetype: quizResults?.archetype || '',
                    scores: quizResults || {}
                });
                localStorage.setItem('quiz_backup', JSON.stringify(backupData));
                console.log('üíæ Saved to local backup');
            } catch (e) {
                console.error('Could not save backup:', e);
            }
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status-indicator');
            statusDiv.textContent = message;
            statusDiv.className = `status-indicator status-${type}`;
            statusDiv.style.display = 'block';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // Main Quiz Functions
        function startJourney() {
            console.log('Starting journey...');
            
            // Track with Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'quiz_started', {
                    'event_category': 'quiz_flow',
                    'event_label': 'intro_screen'
                });
            }

            // Hide intro screen, show demographics
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('demographics-screen').classList.remove('hidden');
        }

        // Start actual quiz function
        async function startActualQuiz() {
            console.log('Starting actual quiz...');
            
            // Get the selected values
            const ethnicity = document.getElementById('ethnicity-select').value;
            const gender = document.getElementById('gender-select').value;
            const orientation = document.getElementById('orientation-select').value;
            
            console.log('Selected values:', { ethnicity, orientation });
            
            // Check if both are selected
            if (!ethnicity || !gender || !orientation) {
                alert('Please select all fields to continue');
                return;
            }
            
            // Store the values
            demographics.ethnicity = ethnicity;
            demographics.gender = gender;
            demographics.orientation = orientation;
            console.log('Demographics stored:', demographics);

            // Try to save to Google Sheets (non-blocking)
            try {
                await saveDemographicsToSheets(demographics);
            } catch (error) {
            }

            // Track with Google Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'demographics_submitted', {
                    'ethnicity': ethnicity,
                    'gender': gender,
                    'orientation': orientation,
                    'event_category': 'quiz_flow',
                    'event_label': 'demographics_complete'
                });
                
                gtag('set', 'user_properties', {
                    'quiz_ethnicity': ethnicity,
                    'quiz_gender': gender,
                    'quiz_orientation': orientation
                });
            }
                    
            // Hide demographics screen and show quiz
            document.getElementById('demographics-screen').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            
            // Reset quiz state and start
            currentQuestion = "1";
            scores = { emotional: 0, logical: 0, exploratory: 0 };
            selectedChoices.clear();
            multiSelectNexts = [];
            pendingQuestions = [];
            isInMultiSelectSequence = false;
            multiSelectProgress = 0;
            questionCount = 0;
            
            showQuestion(currentQuestion);
        }

        // Show question function
        function showQuestion(questionId) {
            console.log('Showing question:', questionId);
            
            questionCount++;
            updateProgressBar();
            
            const question = questions[questionId];
            if (!question) {
                console.error('Question not found:', questionId);
                return;
            }
            
            const container = document.getElementById('question-content');
            
            // Track question view
            if (typeof gtag !== 'undefined') {
                gtag('event', 'question_viewed', {
                    'question_id': questionId,
                    'question_type': question.multiSelect ? 'multi_select' : 'single_select',
                    'event_category': 'quiz_flow',
                    'event_label': `question_${questionId}`
                });
            }
            
            let html = `<div class="question-container">`;
            
            // Add indicator if this is from a multi-select sequence
            if (isInMultiSelectSequence) {
                html += `<div style="text-align: center; color: #e88896; margin-bottom: 20px; font-size: 0.9em;">Activity ${multiSelectProgress} of 2</div>`;
            }
            
            html += `<div class="scenario">${question.scenario}</div>`;
            
            if (question.multiSelect) {
                html += `<div class="multi-select-info">Select exactly ${question.multiSelect} options</div>`;
            }
            
            html += `<div class="choices">`;
            
            question.choices.forEach((choice, index) => {
                html += `<div class="choice" onclick="selectChoice('${questionId}', ${index})">${choice.text}</div>`;
            });
            
            html += `</div>`;
            html += `<button class="next-btn" id="next-btn" onclick="nextQuestion()" disabled>Continue</button>`;
            html += `</div>`;
            
            container.innerHTML = html;
            selectedChoices.clear();
            multiSelectNexts = [];
            
            console.log('Question displayed successfully');
        }

        // Update progress bar
        function updateProgressBar() {
            const progress = (questionCount / totalEstimatedQuestions) * 100;
            document.getElementById('currentQuestion').textContent = questionCount;
            document.getElementById('totalQuestions').textContent = totalEstimatedQuestions;
            document.getElementById('progressFill').style.width = `${Math.min(progress, 100)}%`;
        }

        // Select choice function
        function selectChoice(questionId, choiceIndex) {
            console.log('Choice selected:', questionId, choiceIndex);
            
            const question = questions[questionId];
            const choice = question.choices[choiceIndex];
            
            // Track choice selection
            if (typeof gtag !== 'undefined') {
                gtag('event', 'answer_selected', {
                    'question_id': questionId,
                    'choice_index': choiceIndex,
                    'choice_text': choice.text.substring(0, 50),
                    'event_category': 'quiz_engagement',
                    'event_label': `q${questionId}_choice${choiceIndex}`
                });
            }
            
            const choiceElements = document.querySelectorAll('.choice');
            
            if (question.multiSelect) {
                // Multi-select logic
                if (selectedChoices.has(choiceIndex)) {
                    selectedChoices.delete(choiceIndex);
                    choiceElements[choiceIndex].classList.remove('selected');
                } else if (selectedChoices.size < question.multiSelect) {
                    selectedChoices.add(choiceIndex);
                    choiceElements[choiceIndex].classList.add('selected');
                }
                
                // Enable/disable next button
                document.getElementById('next-btn').disabled = selectedChoices.size !== question.multiSelect;
            } else {
                // Single select logic
                choiceElements.forEach(el => el.classList.remove('selected'));
                choiceElements[choiceIndex].classList.add('selected');
                selectedChoices.clear();
                selectedChoices.add(choiceIndex);
                document.getElementById('next-btn').disabled = false;
            }
        }

        // Next question function
        function nextQuestion() {
            console.log('Moving to next question...');
            
            const question = questions[currentQuestion];
            let nextQuestionId = null;
            
            // Calculate scores
            selectedChoices.forEach(index => {
                const choice = question.choices[index];
                scores.emotional += choice.scores.emotional;
                scores.logical += choice.scores.logical;
                scores.exploratory += choice.scores.exploratory;
                
                if (question.multiSelect) {
                    multiSelectNexts.push(choice.next);
                } else if (pendingQuestions.length === 0) {
                    // Only set next if we don't have pending questions
                    nextQuestionId = choice.next;
                }
            });
            
            console.log('Current scores:', scores);
            
            // Handle multi-select navigation
            if (question.multiSelect && multiSelectNexts.length > 0) {
                // Start multi-select sequence
                isInMultiSelectSequence = true;
                multiSelectProgress = 1;
                pendingQuestions = [...multiSelectNexts];
                multiSelectNexts = [];
                // Show the first selected question
                nextQuestionId = pendingQuestions.shift();
            } else if (pendingQuestions.length > 0) {
                // Continue multi-select sequence
                multiSelectProgress = 2;
                nextQuestionId = pendingQuestions.shift();
            } else {
                // End multi-select sequence if we were in one
                if (isInMultiSelectSequence) {
                    isInMultiSelectSequence = false;
                    multiSelectProgress = 0;
                }
                // Use the normal next question logic
                if (!nextQuestionId) {
                    const choiceIndex = [...selectedChoices][0];
                    nextQuestionId = question.choices[choiceIndex].next;
                }
            }
            
            console.log('Next question ID:', nextQuestionId);
            
            if (nextQuestionId === "end" || !questions[nextQuestionId]) {
                showResults();
            } else {
                currentQuestion = nextQuestionId;
                showQuestion(currentQuestion);
            }
        }

        // Calculate archetype
        function calculateArchetype() {
            let minDistance = Infinity;
            let closestArchetype = null;
            
            archetypes.forEach(archetype => {
                const distance = Math.sqrt(
                    Math.pow(scores.logical - archetype.logical, 2) +
                    Math.pow(scores.emotional - archetype.emotional, 2) +
                    Math.pow(scores.exploratory - archetype.exploratory, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestArchetype = archetype;
                }
            });
            
            return closestArchetype;
        }

        // Show results
        async function showResults() {
            console.log('Showing results...');
            
            const archetype = calculateArchetype();
            const vulnerabilities = getPersonalizedVulnerabilities(
                archetype.name, 
                demographics.gender, 
                demographics.orientation
            );
            
            console.log('Personalized vulnerabilities:', vulnerabilities);
            const traits = archetypeTraits[archetype.name] || { keywords: ""} || { description: "" };
            
            console.log('Archetype:', archetype);
            console.log('Vulnerabilities:', vulnerabilities);
            
            // Save final results to Google Sheets (non-blocking)
            try {
                await saveDemographicsToSheets(demographics, {
                    archetype: archetype.name,
                    emotional: scores.emotional,
                    logical: scores.logical,
                    exploratory: scores.exploratory
                });
            } catch (error) {
                console.log('Failed to save final results, but showing results anyway');
            }

            // Track completion
            if (typeof gtag !== 'undefined') {
                gtag('event', 'quiz_completed', {
                    'ethnicity': demographics.ethnicity,
                    'gender': demographics.gender,
                    'orientation': demographics.orientation,
                    'archetype_result': archetype.name,
                    'emotional_score': scores.emotional,
                    'logical_score': scores.logical,
                    'exploratory_score': scores.exploratory,
                    'total_score': scores.emotional + scores.logical + scores.exploratory,
                    'number_of_matches': vulnerabilities.length,
                    'event_category': 'quiz_completion',
                    'event_label': archetype.name,
                    'value': 1
                });
            }

            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('result-container').classList.remove('hidden');
            
            let html = `
                <div class="result-container">
                    <div class="section-header">
                        <h2 class="section-title">‚ú® Your Travel Personality Revealed</h2>
                        <p class="section-subtitle">Based on your choices, here's who you are at your core:</p>
                    </div>
                    <div class="personality-intro">
                        <div class="archetype-keywords">
                            ${traits.keywords.map(keyword => `<span class="keyword-tag">${keyword}</span>`).join('')}
                        </div>
                        <p class="personality-text">${traits.description}</p>
                    </div>
                        <div class="toxic-section-divider">
                            <div class="section-header toxic-header">
                                <p class="warning-text">‚ö†Ô∏è WARNING: Toxic Attraction Patterns Detected</p>
                                <p class="section-subtitle">Your beautiful traits make you a magnet for these toxic profiles:</p>
                            </div>
                        </div>
                    <div class="cards-container">
            `;
            
            // Generate cards for each vulnerability
            vulnerabilities.forEach((vuln, index) => {
                const matchPercentage = 70 + Math.floor((scores.emotional + scores.logical + scores.exploratory + index * 5) % 20);
                
                html += `
                    <div class="character-card" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div class="match-percentage">${matchPercentage}% MATCH</div>
                                <h3 class="card-title">${vuln.title}</h3>
                                <div class="character-avatars">
                `;
                
                vuln.characters.forEach(char => {
                    html += `<span class="avatar">${char}</span>`;
                });
                
                html += `
                                </div>
                                <p class="attraction-text">"${vuln.why}"</p>
                                <div class="click-to-flip">Click to reveal the truth ‚Üí</div>
                            </div>
                            
                            <div class="card-back">
                                <h3 class="card-title" style="color: #e74c3c;">üö© RED FLAGS üö©</h3>
                                <div class="red-flags">
                                    <div class="red-flag"><strong>The Plot Twist:</strong> ${vuln.plotTwist}</div>
                                    <div class="red-flag"><strong>Your Blind Spot:</strong> ${vuln.blindSpot}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <p style="text-align: center; color: rgba(255, 255, 255, 0.6); margin-top: 20px; font-size: 0.9em;">
                        Click each card to reveal the hidden truth
                    </p>
                    
                    <div style="background: rgba(46, 204, 113, 0.1); border: 2px solid rgba(46, 204, 113, 0.3); padding: 30px; border-radius: 15px; margin: 40px auto; max-width: 600px; text-align: center;">
                        <h3 style="color: #2ecc71; margin-bottom: 15px;">üíö Your Protection Protocol</h3>
                        <p>${getGeneralProtectionTip(archetype.name)}</p>
                    </div>
                    
                    <div style="text-align: center; margin: 30px 0;">
                        <h3 style="color: #e88896; margin-bottom: 15px; font-size: 1.8em;">
                            Wait... does someone in your life remind you of these characters?
                        </h3>
                        <p style="color: rgba(0, 0, 0, 0.9); margin-bottom: 25px; font-size: 1.2em; font-style: italic;">
                            Our AI Relationship Coach can analyze your relationship patterns and reveal if you're already living this story...
                        </p>
                        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                            <a href="https://6851c5d59fdb71b6babeee51--partner-assessment-tool.netlify.app" style="background: linear-gradient(45deg, #e88896cf, #110cff73);; color: white; padding: 15px 30px; border-radius: 30px; text-decoration: none; display: inline-block; font-weight: bold;">Talk to Our Relationship Coach</a>
                            <a href="https://tally.so/r/w8gx25" style="background: rgba(0, 0, 0, 0.18); color: black; padding: 15px 30px; border-radius: 30px; text-decoration: none; display: inline-block; border: 2px solid rgba(255, 255, 255, 0.3);">Give Feedback</a>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('result-content').innerHTML = html;
            
            console.log('Results displayed successfully');
        }

        // Helper functions
        function flipCard(card) {
            card.classList.toggle('flipped');
        }
        
        function getGeneralProtectionTip(archetypeName) {
            const tips = {
                "Intellectual": "Trust your emotions as much as your mind. Red flag: Anyone who dismisses your feelings as 'illogical'.",
                "Achiever": "You can't fix someone who doesn't want to be fixed. Red flag: Anyone who makes their problems your projects.",
                "Leader": "True partners support, not compete. Red flag: Anyone who undermines your success.",
                "Explorer": "Adventure shouldn't mean constant chaos. Red flag: Anyone whose drama becomes your daily life.",
                "Rebel": "Independence doesn't mean isolation. Red flag: Anyone who weaponizes your need for freedom.",
                "Peacemaker": "Your kindness isn't weakness. Red flag: Anyone who exploits your desire for harmony.",
                "Dreamer": "Dreams need foundation in reality. Red flag: Anyone who sells you beautiful lies.",
                "Caregiver": "You can't pour from an empty cup. Red flag: Anyone who only takes without giving."
            };
            
            return tips[archetypeName] || "Trust your instincts. If something feels off, it probably is.";
        }

        // Track CTA clicks
        document.removeEventListener('click', arguments.callee);

        document.addEventListener('click', function(e) {
            console.log('üëÜ Document click detected on:', e.target.tagName, e.target);
            
            // Find the actual link element
            let clickedLink = null;
            
            // Check if the clicked element is a link
            if (e.target.tagName === 'A') {
                clickedLink = e.target;
            } 
            // Check if the clicked element is inside a link
            else if (e.target.closest('a')) {
                clickedLink = e.target.closest('a');
            }
            
            // If no link found, exit
            if (!clickedLink || !clickedLink.href) {
                console.log('üëÜ Not a link click, ignoring');
                return;
            }
            
            console.log('üîó Link click detected:', {
                href: clickedLink.href,
                text: clickedLink.textContent.trim(),
                tagName: clickedLink.tagName
            });
            
            // Check if it's the chatbot link
            if (clickedLink.href.includes('partner-assessment-tool')) {
                console.log('ü§ñ CHATBOT LINK CLICKED! Starting tracking...');
                
                try {
                    // Get user archetype safely
                    let userArchetype = 'unknown';
                    try {
                        if (typeof calculateArchetype === 'function') {
                            const archetypeResult = calculateArchetype();
                            userArchetype = archetypeResult?.name || 'unknown';
                            console.log('‚úÖ Got archetype:', userArchetype);
                        } else {
                            console.warn('‚ö†Ô∏è calculateArchetype function not available');
                        }
                    } catch (err) {
                        console.warn('‚ö†Ô∏è Error getting archetype:', err);
                    }
                    
                    // Get demographics safely
                    let userEthnicity = 'unknown';
                    let userGender = 'unknown'
                    let userOrientation = 'unknown';
                    try {
                        if (typeof demographics !== 'undefined' && demographics) {
                            userEthnicity = demographics.ethnicity || 'unknown';
                            userGender = demographics.gender || 'unknown';
                            userOrientation = demographics.orientation || 'unknown';
                            console.log('‚úÖ Got demographics:', { userEthnicity, userGender, userOrientation });
                        } else {
                            console.warn('‚ö†Ô∏è Demographics not available');
                        }
                    } catch (err) {
                        console.warn('‚ö†Ô∏è Error getting demographics:', err);
                    }
                    
                    // Prepare event data
                    const eventData = {
                        'event_category': 'conversion',
                        'event_label': 'ai_coach_cta',
                        'value': 1,  // Important: number, not string
                        'cta_type': 'primary',
                        'cta_text': clickedLink.textContent.trim(),
                        'cta_destination': clickedLink.href,
                        'user_archetype': userArchetype,
                        'user_ethnicity': userEthnicity,
                        'user_sexual': userSexual,
                        'user_orientation': userOrientation,
                        'timestamp': new Date().toISOString()
                    };
                    
                    console.log('üìä Prepared event data:', eventData);
                    
                    // Send to Google Analytics
                    if (typeof gtag !== 'undefined') {
                        console.log('üì§ Sending to Google Analytics...');
                        gtag('event', 'cta_clicked', eventData);
                        console.log('‚úÖ GA4 event sent successfully!');
                        
                        // Also send as conversion for better tracking
                        gtag('event', 'conversion', {
                            'send_to': 'G-N2JZPNV27G',
                            'value': 1,
                            'currency': 'USD',
                            'transaction_id': 'cta_' + Date.now()
                        });
                        console.log('‚úÖ Conversion event sent!');
                        
                    } else {
                        console.error('‚ùå gtag function not available!');
                    }
                    
                    // Show visual confirmation
                    if (typeof showStatus === 'function') {
                        showStatus('üéØ Click tracked successfully!', 'success');
                    }
                    
                    // Log successful tracking
                    console.log('üéâ CTA CLICK TRACKING COMPLETE!', {
                        timestamp: new Date().toISOString(),
                        archetype: userArchetype,
                        demographics: { userEthnicity, userGender, userOrientation },
                        destination: clickedLink.href
                    });
                    
                } catch (error) {
                    console.error('‚ùå Error in CTA click tracking:', error);
                }
            }
            
            // Track feedback clicks too
            else if (clickedLink.href.includes('tally.so')) {
                console.log('üìù Feedback link clicked');
                
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'feedback_clicked', {
                        'event_category': 'engagement',
                        'event_label': 'feedback_form',
                        'value': 1,
                        'cta_type': 'secondary'
                    });
                    console.log('‚úÖ Feedback click tracked');
                }
            }
            
            else {
                console.log('üîó Other link clicked:', clickedLink.href);
            }
            
        }, true); // Use capture phase to ensure we catch the event

        // Test function to verify the listener is working
        window.testClickListener = function() {
            console.log('üß™ Testing click listener...');
            
            const chatbotLink = document.querySelector('a[href*="partner-assessment-tool"]');
            if (!chatbotLink) {
                console.error('‚ùå No chatbot link found');
                return false;
            }
            
            console.log('üîó Found chatbot link:', chatbotLink.href);
            
            // Create a proper click event
            const clickEvent = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window,
                detail: 1
            });
            
            console.log('üéØ Dispatching click event...');
            chatbotLink.dispatchEvent(clickEvent);
            
            console.log('‚úÖ Click event dispatched - check console for tracking logs');
            return true;
        };

        console.log('‚úÖ Working click listener installed!');
        console.log('üß™ Run testClickListener() to test it right now');
        console.log('üîó Or just click the "Talk to Our Relationship Coach" button');

        // Console logging for debugging
        console.log('Quiz script loaded successfully');
        console.log('Available functions:', {
            startJourney: typeof startJourney,
            startActualQuiz: typeof startActualQuiz,
            showQuestion: typeof showQuestion,
            selectChoice: typeof selectChoice,
            nextQuestion: typeof nextQuestion,
            showResults: typeof showResults,
            saveDemographicsToSheets: typeof saveDemographicsToSheets
        });
        console.log('Google Sheets URL configured:', GOOGLE_SHEETS_URL ? 'Yes' : 'No');
    </script>
</body>
</html>